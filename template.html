<link type="text/css" rel="stylesheet" href="http://annotorious.github.io/latest/themes/dark/annotorious-dark.css"/>
<link rel="stylesheet" href="/static/vendor/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
<div id="survey" class="modal fade" data-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Hey there! Do you want to help us?</h4>
      </div>
      <div class="modal-body">
          Thanks for contributing one task for the project. We are interested in knowing how you found out about us. <strong>Could you please answer two questions in a short survey?</strong>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Skip</button>
        <a class="btn btn-large btn-success" href="https://docs.google.com/forms/d/1lNhBvKqPQlaJpWcvbEMfOGlixf7BHC__9w9JYs0Yw_4/viewform?embedded=true">Of course! Take me to the survey!</a>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Success and Error Messages for the user --> 
<div style="margin-top:15px;">
   <div id="success" class="alert alert-success" style="display:none;">
      <strong>Well done!</strong> You have successfully submitted your tags. Here is another photograph to try if you wish!
   </div>        
   <div id="loading" class="alert alert-info" style="display:none;">
      <img src="/static/img/loading.gif">Loading next task...
   </div>
   <div id="taskcompleted" class="alert alert-info" style="display:none;">
      <strong>The task has been completed!</strong> Thanks a lot!
   </div>
   <div id="finish" class="alert alert-success" style="display:none;">
      <strong>Congratulations!</strong> You have participated in all available tasks!
      <div class="alert-actions">
         <a class="btn-default btn" href="/">Go back</a>
         <a class="btn-default btn" href="/app">or, Check other applications</a>
      </div>
   </div>
   <div id="error" class="alert alert-error" style="display:none;">
      <a class="close">Ã—</a>
      <strong>Error!</strong> Something went wrong, please contact the site administrators
   </div>
</div><!-- End Success and Error Messages for the user -->

<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<!-- Start Skeleton Row -->    
<div class="row skeleton">

   <div class="btn-group pull-right">
      <button class="btn btn-info btn-sm" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-eye-open"></i> Tutorial</button>
      <a class="btn btn-info btn-sm" id="imgLink" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window" href="http://community.micropasts.org/category/crowdsourcing-support"><i class="glyphicon glyphicon-book"></i> Community Help</a>
      <a class="btn btn-info btn-sm" id="newTask" href="../phototaggingHorsfield/newtask"><i class="glyphicon glyphicon-picture"></i> Different photograph?</a>  
      <a id="flickr" rel="tooltip" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window" href="" class="btn btn-sm btn-info"><i class="icon icon-flickr"></i> View on flickr</a>
      <a id="down" rel="tooltip" data-toggle="tooltip" data-placement="top" title="Only works for compliant browsers" download="" href="" class="btn btn-sm btn-info" ><i class="glyphicon glyphicon-download"></i> Download</a>
   </div>

   <h1 id="step1">Please tag this photograph</h1><!-- id="start" instead? -->
   <div class="btn-group">
      <button id="status" type="button" class="btn btn-default btn-type disabled" name="loading" value="loading">Loading photo</button>
    </div>
    <div class="btn-group">
       <button id="btn-save" class="btn btn-success btn-answer" value='save'><i class="icon icon-white icon-save"></i> Submit your tags</button>
    </div>

</div><!-- End of Skeleton Row -->

<div class="row skeleton"><!-- Start Skeleton Row-->

   <div class="col-md-12"><!-- Start of Photo DIV (column) -->
      <!-- some of these divs are redundant: -->
      <div id="imgContainer" >
         <span id="photo-link">
            <img id="photo" src="http://i.imgur.com/GeHxzb7.png" style="max-width:100%">
         </span>
      </div>
      <div id="taskImg"></div>

   </div><!-- End of Photo DIV (column) -->

   <div class="col-md-4">
      <!-- Start of Question and Submission DIV (column) -->
      <!-- Feedback items for the user -->
      <p>You are working now on task: <span id="task-id" class="label label-warning">#</span></p>
      <p>You have completed: <span id="done" class="label label-info"></span> tasks from
      <!-- Progress bar for the user -->
      <span id="total" class="label label-inverse"></span></p>
      <div class="progress progress-striped">
         <div id="progress" rel="tooltip" title="#" class="bar" style="width:0%;"></div>
      </div>
      <div id="answer"></div><!-- DIV for the submission buttons -->
    </div><!-- End of Question and Submission DIV (column) -->

</div><!-- End of Skeleton Row -->

<!-- Modal start -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <!-- Modal header --> 
         <div class="modal-header">
            <h3>Tagging Photos Tutorial</h3>
         </div>
         <div id="0" class="modal-body" style="display:none">
            <p>The application is really simple. It loads a photo from <a href="http://flickr.com">Flickr</a> and asks you this question: <strong>Tag all the elements that you recognise</strong></p>.
            <p>You then hover the mouse over the elements that you can identify, and draw a box clicking in the image, and you will be able to type the name of that element and save it.</p>
            <p>You can do it as many times as you want. Simple, right? Now let's try it!</p> 
         </div>
         <!-- Modify the tutorial; include a photograph with tagging examples
         <img src="https://farm4.staticflickr.com/3796/13464348955_a06ecab512.jpg" width="500" height="308" class="img-polaroid" alt="An example of an artefact photograph whose outline has been defined " / -->        
         <div id="1" class="modal-body" style="display:none">
            <p>More tutorial stuff...</p>    
            <p></p>         
            <p>To find out how the project is progressing, to suggest changes to this application or to propose new research ideas based what you have transcribed, please have a look at our <a href="http://community.micropasts.org" title="Community forum">community forum</a>.</p>
         </div>
      <!-- End of stepped modal body -->

      <!-- Modal footer -->
      <div class="modal-footer">
         <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
         <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
         <button id="startContrib" data-dismiss="modal" class="btn btn-primary" style="display:none"><i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
      </div>
    </div>
  </div>
</div>
<!-- Modal end --> 

<script type="text/javascript" src="/static/js/vendor/annotorious.min.js"></script>
<script type="text/javascript" src="http://annotorious.github.io/demos/semantic-tagging-plugin.js"></script>
<script>
      //anno.addPlugin('SemanticTagging', { endpoint_url: 'http://samos.mminf.univie.ac.at:8080/wikipediaminer' });
</script>
<script>
pybossa.taskLoaded(function(task, deferred) {
    if ( ! $.isEmptyObject(task) ) {
        // load image from flickr
        var img = $('<img />');
        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        // Flickr uses different suffixes for different picture sizes:
        // _s.jpg    small square 75x75
        // _q.jpg    large square 150x150
        // _t.jpg    thumbnail, 100 on longest side
        // _m.jpg    small, 240 on longest side
        // _n.jpg    small, 320 on longest side
        // .jpg      medium, 500 on longest side
        // _z.jpg    medium 640, 640 on longest side
        // _c.jpg    medium 800, 800 on longest side
        // _b.jpg    large, 1024 on longest side*
        // _o.jpg    original image, either a jpg, gif or png, depending on source format
        img.attr('src', task.info.url_raw + "_z.jpg");
        img.attr('id', 'anno_' + task.id);
        img.addClass('img-polaroid');
        img.addClass('annotable');
        task.info.image = img;
    }
    else {
        deferred.resolve(task);
    }
});

pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        $('#photo-link').html('').append(task.info.image);
        //$("#question").html(task.info.question);
        $('#task-id').html(task.id);

        $("#btn-submit").html("<i class='icon-repeat'></i> I don't recognize any person, try next one");
        $("#btn-submit").removeClass("btn-success");
        // Load data details
        $("#title").text(task.info.title);
        $("#description").html(task.info.description);
        $("#date_taken").html(task.info.date_taken);
        $("#tags").html(task.info.tags);

        anno.makeAnnotatable(document.getElementById('anno_' + task.id));

        anno.addHandler('onAnnotationCreated', function(annotation) {
            //console.log(annotation.text);
            $("#btn-submit").html("<i class='icon icon-save'></i> Save current annotations");
            $("#btn-submit").addClass("btn-success");
        });

        $('.btn-answer').off('click').on('click', function(evt) {
            var answer = $(evt.target).attr("value");
            if (typeof answer != 'undefined') {
                //console.log(answer);
                pybossa.saveTask(task.id, anno.getAnnotations()).done(function() {
                    deferred.resolve();
                });
                $("#loading").fadeIn(500);
                if ($("#disqus_thread").is(":visible")) {
                    $('#disqus_thread').toggle();
                    $('.btn-disqus').toggle();
                }
            }
            else {
                $("#error").show();
            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

pybossa.run('phototaggingHorsfield');
</script>